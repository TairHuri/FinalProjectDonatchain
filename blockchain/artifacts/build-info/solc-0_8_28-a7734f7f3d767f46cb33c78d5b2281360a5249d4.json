{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_28-a7734f7f3d767f46cb33c78d5b2281360a5249d4",
  "solcVersion": "0.8.28",
  "solcLongVersion": "0.8.28+commit.7893614a",
  "userSourceNameMap": {
    "contracts/Donatchain.sol": "project/contracts/Donatchain.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "cancun",
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": []
    },
    "sources": {
      "project/contracts/Donatchain.sol": {
        "content": "// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.19;\r\n\r\ncontract Donatchain {\r\n    \r\n    // -------- Basic permissions --------\r\n    address public owner;\r\n    modifier onlyOwner() { require(msg.sender == owner, \"not owner\"); _; }\r\n\r\n    modifier onlyOwnerOrManager(uint256 campaignId) {\r\n        require(\r\n            msg.sender == owner || msg.sender == campaigns[campaignId].manager,\r\n            \"not manager/owner\"\r\n        );\r\n        _;\r\n    }\r\n\r\n    // -------- Pause --------\r\n    bool public paused;\r\n    modifier whenNotPaused() { require(!paused, \"paused\"); _; }\r\n    function setPaused(bool p) external onlyOwner { paused = p; }\r\n\r\n    // -------- Campaign model --------\r\n    struct Campaign {\r\n        uint256 campaignId;\r\n        string  campaignName;\r\n        uint256 charityId;\r\n\r\n        uint64  startDate;   // unix timestamp (seconds)\r\n        uint64  endDate;     // unix timestamp (seconds)\r\n        \r\n        uint256 goalAmount;\r\n        uint256 totalCrypto;     \r\n        uint256 totalCredit;\r\n\r\n        address manager;       \r\n        address beneficiary;\r\n\r\n        bool    active;    \r\n    }\r\n\r\n    uint256 public nextCampaignId;\r\n    mapping(uint256 => Campaign) public campaigns;\r\n\r\n\r\n    // -------- Events --------\r\n    event CampaignCreated(\r\n        uint256 indexed campaignId,\r\n        string  campaignName,\r\n        uint256 charityId,\r\n        uint64  startDate,\r\n        uint64  endDate,\r\n        uint256 goalAmount,\r\n        address beneficiary,\r\n        address manager\r\n    );\r\n\r\n    event CampaignUpdated(\r\n        uint256 indexed campaignId,\r\n        string  campaignName,\r\n        uint64  startDate,\r\n        uint64  endDate,\r\n        uint256 goalAmount\r\n    );\r\n\r\n    event CampaignStatusChanged(\r\n        uint256 indexed campaignId,\r\n        bool active\r\n    );\r\n\r\n      event ManyCampaignsStatusChanged(\r\n        uint256 indexed campaignId,\r\n        bool active\r\n    );\r\n\r\n    event CryptoDonation(\r\n        uint256 indexed campaignId,\r\n        address indexed donor,\r\n        uint256 amount\r\n    );\r\n\r\n    event CreditDonationRecorded(\r\n        uint256 indexed campaignId,\r\n        uint256 ILSAmount,\r\n        uint256 originalAmount,\r\n        string  currency,\r\n        string  refCode\r\n    );\r\n\r\n    // -------- Constructor --------\r\n    constructor() {\r\n        owner = msg.sender;\r\n        paused = false;\r\n    }\r\n\r\n    // -------- Create campaign --------\r\n    function createCampaign(\r\n        string  calldata campaignName,\r\n        uint256         charityId,\r\n        uint64          startDate,\r\n        uint64          endDate,\r\n        uint256         goalAmount,\r\n        address         beneficiary\r\n    )\r\n        external\r\n        whenNotPaused\r\n        returns (uint256 id)\r\n    {\r\n        require(bytes(campaignName).length > 0, \"empty name\");\r\n        require(beneficiary != address(0), \"bad beneficiary\");\r\n\r\n        require(startDate >= block.timestamp, \"start in past\"); // Start date not in the past\r\n        require(endDate > startDate, \"bad end date\"); // End date must be greater than start date\r\n\r\n        require(goalAmount > 0, \"goal=0\"); //goalAmount greater than 0\r\n\r\n        id = nextCampaignId++;\r\n\r\n        campaigns[id] = Campaign({\r\n            campaignId:   id,\r\n            campaignName: campaignName,\r\n            charityId:    charityId,\r\n            startDate:    startDate,\r\n            endDate:      endDate,\r\n            goalAmount:   goalAmount,\r\n            totalCrypto:  0,\r\n            totalCredit:  0,\r\n            manager:      msg.sender,\r\n            beneficiary:  beneficiary,\r\n            active:       true\r\n        });\r\n\r\n        emit CampaignCreated(\r\n            id,\r\n            campaignName,\r\n            charityId,\r\n            startDate,\r\n            endDate,\r\n            goalAmount,\r\n            beneficiary,\r\n            msg.sender\r\n        );\r\n    }\r\n\r\n    // -------- Update campaign --------\r\n    function updateCampaign(\r\n        uint256 campaignId,\r\n        string  calldata campaignName,\r\n        uint64          newStartDate,\r\n        uint64          newEndDate,\r\n        uint256         newGoalAmount\r\n    )\r\n        external\r\n        onlyOwnerOrManager(campaignId)\r\n        whenNotPaused\r\n    {\r\n        Campaign storage c = campaigns[campaignId];\r\n        require(c.manager != address(0), \"unknown campaign\");\r\n        require(bytes(campaignName).length > 0, \"empty name\");\r\n\r\n        c.campaignName = campaignName;\r\n\r\n        //Conditions for updating start date\r\n        if (newStartDate != 0) {\r\n            require(block.timestamp < c.startDate, \"start already passed\");\r\n            require(newStartDate >= block.timestamp, \"start in past\");\r\n            require(newStartDate < c.endDate, \"start >= end\");\r\n            c.startDate = newStartDate;\r\n        }\r\n\r\n        //Conditions for updating end date\r\n        if (newEndDate != 0) {\r\n            require(block.timestamp < c.endDate, \"end already passed\");\r\n            require(newEndDate > c.startDate, \"end <= start\");\r\n            c.endDate = newEndDate;\r\n        }\r\n\r\n        require(newGoalAmount > 0, \"goal=0\");\r\n        c.goalAmount = newGoalAmount;\r\n\r\n        emit CampaignUpdated(\r\n            campaignId,\r\n            c.campaignName,\r\n            c.startDate,\r\n            c.endDate,\r\n            c.goalAmount\r\n        );\r\n    }\r\n\r\n    // -------- Update active field --------\r\n    function updateCampaignActive(uint256 campaignId, bool newActive)\r\n        external\r\n        onlyOwnerOrManager(campaignId)\r\n    {\r\n        Campaign storage c = campaigns[campaignId];\r\n        require(c.manager != address(0), \"unknown campaign\");\r\n\r\n        c.active = newActive;\r\n\r\n        emit CampaignStatusChanged(campaignId, c.active);\r\n    }\r\n\r\n  // -------- Update active field for many campaigns --------\r\n    function updateManyCampaignsActive(uint256[] calldata campaignIds,bool newActive) \r\n    external \r\n    {\r\n         address sender = msg.sender;\r\n\r\n        for (uint256 i = 0; i < campaignIds.length; i++) {\r\n        uint256 campaignId = campaignIds[i];\r\n        Campaign storage c = campaigns[campaignId];\r\n\r\n        require(c.manager != address(0), \"unknown campaign\");\r\n        require(\r\n           sender == owner || sender == c.manager,\r\n            \"not owner/manager\"\r\n        );\r\n\r\n        c.active = newActive;\r\n        emit ManyCampaignsStatusChanged(campaignId, c.active);\r\n    }\r\n    }\r\n\r\n    // -------- Donate in crypto (ETH) --------\r\n    function donateCrypto(uint256 campaignId)\r\n        external\r\n        payable\r\n        whenNotPaused\r\n    {\r\n        Campaign storage c = campaigns[campaignId];\r\n        require(c.beneficiary != address(0), \"unknown campaign\");\r\n        require(c.active, \"inactive\");\r\n\r\n        // Donate only between start date and end date\r\n        require(block.timestamp >= c.startDate, \"not started\");\r\n        require(block.timestamp <= c.endDate, \"ended\");\r\n\r\n        require(msg.value > 0, \"no value\");\r\n\r\n        c.totalCrypto += msg.value;\r\n\r\n        (bool ok,) = c.beneficiary.call{value: msg.value}(\"\");\r\n        require(ok, \"transfer failed\");\r\n\r\n        emit CryptoDonation(campaignId, msg.sender, msg.value);\r\n    }\r\n\r\n    // -------- Record Credit donation --------\r\n    function recordCreditDonation(\r\n        uint256 campaignId,\r\n        uint256 originalAmount,\r\n        uint256 ILSAmount,\r\n        string  calldata currency,\r\n        string  calldata refCode\r\n    )\r\n        external\r\n        onlyOwner\r\n        whenNotPaused\r\n    {\r\n        Campaign storage c = campaigns[campaignId];\r\n        require(c.beneficiary != address(0), \"unknown campaign\");\r\n        require(ILSAmount > 0, \"amount=0\");\r\n\r\n\r\n        require(c.active, \"inactive\");\r\n        // Donate only between start date and end date\r\n        require(block.timestamp >= c.startDate, \"not started\");\r\n        require(block.timestamp <= c.endDate, \"ended\");\r\n\r\n        c.totalCredit += ILSAmount;\r\n\r\n        emit CreditDonationRecorded(campaignId, ILSAmount, originalAmount, currency, refCode);\r\n    }\r\n\r\n    // -------- Ownership --------\r\n    function transferOwnership(address newOwner) external onlyOwner {\r\n        require(newOwner != address(0), \"bad owner\");\r\n        owner = newOwner;\r\n    }\r\n}\r\n"
      }
    }
  }
}